{"version":3,"file":"CardPaymentService.js","sourceRoot":"src/","sources":["services/CardPaymentService.ts"],"names":[],"mappings":";;;;AAAA,yCAA6C;AAC7C,iCAA8C;AAC9C,wBAAsB;AACtB,mCAAgC;AASzB,IAAM,kBAAkB,GAAxB,MAAM,kBAAkB;IAE7B,MAAM,CAAS;IAEf,gBAAe,CAAC;IAEhB,KAAK,CAAC,kBAAkB,CACtB,OAAe,EACf,KAAa;QAEb,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACxD,oBAAoB,EAAE,CAAC,MAAM,CAAC;YAC9B,UAAU,EAAE;gBACV;oBACE,UAAU,EAAE;wBACV,QAAQ,EAAE,KAAK;wBACf,YAAY,EAAE;4BACZ,IAAI,EAAE,SAAS,OAAO,EAAE;yBACzB;wBACD,WAAW,EAAE,KAAK,GAAG,GAAG;qBACzB;oBACD,QAAQ,EAAE,CAAC;iBACZ;aACF;YACD,IAAI,EAAE,SAAS;YACf,WAAW,EAAE,oCAAoC;YACjD,UAAU,EAAE,mCAAmC;SAChD,CAAC,CAAC;QACH,wCAAwC;QACxC,OAAO;YACL,WAAW,EAAE,MAAM,CAAC,GAAa;YACjC,SAAS,EAAG,MAAc,CAAC,OAAiB;SAC7C,CAAC;IACJ,CAAC;CACF,CAAA;AAlCY,gDAAkB;AAE7B;IADC,IAAA,WAAM,GAAE;sCACD,eAAM;kDAAC;6BAFJ,kBAAkB;IAP9B,IAAA,sBAAa,EAAC;QACb,MAAM,EAAE;YACN,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI,EAAE;YACxC,UAAU,EAAE,YAAY;SACzB;KACF,CAAC;IACD,IAAA,eAAU,GAAE;;GACA,kBAAkB,CAkC9B","sourcesContent":["import { Configuration } from \"@tsed/common\";\nimport { Inject, Injectable } from \"@tsed/di\";\nimport \"@tsed/stripe\";\nimport { Stripe } from \"stripe\";\n\n@Configuration({\n  stripe: {\n    apiKey: process.env.STRIPE_API_KEY || \"\",\n    apiVersion: \"2020-08-27\"\n  }\n})\n@Injectable()\nexport class CardPaymentService {\n  @Inject()\n  stripe: Stripe;\n\n  constructor() {}\n\n  async createStripeCharge(\n    tokenId: number,\n    price: number\n  ): Promise<{ payment_url: string; timestamp: number }> {\n    const charge = await this.stripe.checkout.sessions.create({\n      payment_method_types: [\"card\"],\n      line_items: [\n        {\n          price_data: {\n            currency: \"usd\",\n            product_data: {\n              name: `token ${tokenId}`\n            },\n            unit_amount: price * 100\n          },\n          quantity: 1\n        }\n      ],\n      mode: \"payment\",\n      success_url: `http://localhost:8083/success.html`,\n      cancel_url: `http://localhost:8083/cancel.html`\n    });\n    // console.log((charge as any).created);\n    return {\n      payment_url: charge.url as string,\n      timestamp: (charge as any).created as number\n    };\n  }\n}\n"]}